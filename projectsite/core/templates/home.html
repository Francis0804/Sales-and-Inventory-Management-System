{% extends 'base.html' %}
{% load currency_filters %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-4">
  <h2 class="mb-1">Welcome back! {{ user.username }}, Here's your report</h2>
  <p class="text-muted">Here's what's happening with your business today.</p>
</div>

<!-- Top Stats Cards -->
<div class="row g-4">
  <!-- Products Card -->
  <div class="col-lg-6 col-md-6 mb-3">
    <div class="card card-stats h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1 me-3">
            <p class="card-category text-muted mb-1">
              <i class="bi bi-box"></i> Total Products
            </p>
            <h3 class="card-title mb-2">{{ total_products }}</h3>
            <div class="stat-info">
              {% if low_stock_products > 0 %}
                <small class="badge bg-warning-subtle text-warning">
                  <i class="bi bi-exclamation-triangle"></i>
                  {{ low_stock_products }} low stock
                </small>
              {% else %}
                <small class="badge bg-success-subtle text-success">
                  <i class="bi bi-check-circle"></i>
                  All in stock
                </small>
              {% endif %}
            </div>
          </div>
          <div class="icon-big flex-shrink-0" style="font-size: 48px; opacity: 0.15">
            <i class="bi bi-box"></i>
          </div>
        </div>
      </div>
      <a href="{% url 'products-list' %}" class="card-footer bg-transparent border-top text-decoration-none text-center py-2">
        View Products <i class="bi bi-chevron-right"></i>
      </a>
    </div>
  </div>

  <!-- Suppliers Card -->
  <div class="col-lg-6 col-md-6 mb-3">
    <div class="card card-stats h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1 me-3">
            <p class="card-category text-muted mb-1">
              <i class="bi bi-truck"></i> Suppliers
            </p>
            <h3 class="card-title mb-2" style="color: #59d05d;">{{ total_suppliers }}</h3>
            <div class="stat-info">
              <small class="badge bg-success-subtle text-success">
                <i class="bi bi-check-circle"></i>
                Active partners
              </small>
            </div>
          </div>
          <div class="icon-big text-success flex-shrink-0" style="font-size: 48px; opacity: 0.15;">
            <i class="bi bi-truck"></i>
          </div>
        </div>
      </div>
      <a href="{% url 'suppliers-list' %}" class="card-footer bg-transparent border-top text-success text-decoration-none text-center py-2">
        View Suppliers <i class="bi bi-chevron-right"></i>
      </a>
    </div>
  </div>

  <!-- Purchases Card -->
  <div class="col-lg-6 col-md-6 mb-3">
    <div class="card card-stats h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1 me-3">
            <p class="card-category text-muted mb-1">
              <i class="bi bi-download"></i> Purchases
            </p>
            <h3 class="card-title mb-2" style="color: #ff646d;">{{ total_purchases }}</h3>
            <div class="stat-info">
              {% if pending_purchases > 0 %}
                <small class="badge bg-danger-subtle text-danger">
                  <i class="bi bi-clock-history"></i>
                  {{ pending_purchases }} pending
                </small>
              {% else %}
                <small class="badge bg-success-subtle text-success">
                  <i class="bi bi-check-all"></i>
                  All received
                </small>
              {% endif %}
            </div>
          </div>
          <div class="icon-big text-danger flex-shrink-0" style="font-size: 48px; opacity: 0.15;">
            <i class="bi bi-download"></i>
          </div>
        </div>
      </div>
      <a href="{% url 'purchases-list' %}" class="card-footer bg-transparent border-top text-danger text-decoration-none text-center py-2">
        View Purchases <i class="bi bi-chevron-right"></i>
      </a>
    </div>
  </div>

  <!-- Total Tax Card -->
  <div class="col-lg-6 col-md-6 mb-3">
    <div class="card card-stats h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1 me-3">
            <p class="card-category text-muted mb-1">
              <i class="bi bi-receipt"></i> Total Tax Collected
            </p>
            <h3 class="card-title mb-2" style="color: #fd7e14;">P{{ total_tax_amount|currency_format }}</h3>
            <div class="stat-info">
              <small class="badge bg-info-subtle text-info">
                <i class="bi bi-graph-up"></i>
                All time record
              </small>
            </div>
          </div>
          <div class="icon-big text-warning flex-shrink-0" style="font-size: 48px; opacity: 0.15;">
            <i class="bi bi-receipt"></i>
          </div>
        </div>
      </div>
      <a href="{% url 'purchases-list' %}" class="card-footer bg-transparent border-top text-warning text-decoration-none text-center py-2">
        View Purchases <i class="bi bi-chevron-right"></i>
      </a>
    </div>
  </div>
</div>

<!-- Alert Cards -->
<div class="row">
  {% if out_of_stock > 0 %}
  <div class="col-md-6 mb-4">
    <div class="alert alert-danger d-flex align-items-center" role="alert">
      <i class="bi bi-exclamation-octagon me-2" style="font-size: 24px;"></i>
      <div>
        <strong>Out of Stock Alert!</strong>
        <p class="mb-0">You have {{ out_of_stock }} product(s) out of stock. <a href="{% url 'products-list' %}" class="alert-link">View products</a></p>
      </div>
    </div>
  </div>
  {% endif %}

  {% if pending_purchases > 0 %}
  <div class="col-md-6 mb-4">
    <div class="alert alert-warning d-flex align-items-center" role="alert">
      <i class="bi bi-hourglass-split me-2" style="font-size: 24px;"></i>
      <div>
        <strong>Pending Purchases</strong>
        <p class="mb-0">{{ pending_purchases }} purchase order(s) awaiting delivery. <a href="{% url 'purchases-list' %}" class="alert-link">View purchases</a></p>
      </div>
    </div>
  </div>
  {% endif %}

  {% if low_stock_products > 0 %}
  <div class="col-md-6 mb-4">
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-info-circle me-2" style="font-size: 24px;"></i>
      <div>
        <strong>Low Stock Items</strong>
        <p class="mb-0">{{ low_stock_products }} product(s) below reorder level. <a href="{% url 'products-list' %}" class="alert-link">View products</a></p>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<!-- Quick Actions -->
<div class="row">
  <div class="col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-flex flex-wrap gap-2">
          <a href="{% url 'products-add' %}" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle"></i> Add Product
          </a>
          <a href="{% url 'purchases-add' %}" class="btn btn-warning btn-sm">
            <i class="bi bi-download"></i> New Purchase
          </a>
          <a href="{% url 'suppliers-add' %}" class="btn btn-info btn-sm">
            <i class="bi bi-truck"></i> Add Supplier
          </a>
          <a href="{% url 'categories-add' %}" class="btn btn-secondary btn-sm">
            <i class="bi bi-tag"></i> Add Category
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Financial Summary Section -->
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Financial Summary by Period</h5>
      </div>
      <div class="card-body">
        <!-- Period Tabs -->
        <ul class="nav nav-tabs mb-4" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="today-tab" data-bs-toggle="tab" data-bs-target="#today-tab-pane" type="button" role="tab" aria-controls="today-tab-pane" aria-selected="true">
              <i class="bi bi-calendar-day"></i> Today
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="week-tab" data-bs-toggle="tab" data-bs-target="#week-tab-pane" type="button" role="tab" aria-controls="week-tab-pane" aria-selected="false">
              <i class="bi bi-calendar-week"></i> This Week
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="month-tab" data-bs-toggle="tab" data-bs-target="#month-tab-pane" type="button" role="tab" aria-controls="month-tab-pane" aria-selected="false">
              <i class="bi bi-calendar-month"></i> This Month
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="year-tab" data-bs-toggle="tab" data-bs-target="#year-tab-pane" type="button" role="tab" aria-controls="year-tab-pane" aria-selected="false">
              <i class="bi bi-calendar"></i> This Year
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all-tab-pane" type="button" role="tab" aria-controls="all-tab-pane" aria-selected="false">
              <i class="bi bi-graph-up"></i> All Time
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="periodTabContent">
          <!-- Today -->
          <div class="tab-pane fade show active" id="today-tab-pane" role="tabpanel" aria-labelledby="today-tab" tabindex="0">
            <div class="row text-center">
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Purchase Orders</h6>
                <h3 class="text-primary">{{ today_purchases }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Total Amount</h6>
                <h3 class="text-success">P{{ today_purchase_amount|currency_format }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Tax Amount</h6>
                <h3 class="text-warning">P{{ today_tax_amount|currency_format }}</h3>
              </div>
            </div>
          </div>

          <!-- This Week -->
          <div class="tab-pane fade" id="week-tab-pane" role="tabpanel" aria-labelledby="week-tab" tabindex="0">
            <div class="row text-center">
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Purchase Orders</h6>
                <h3 class="text-primary">{{ week_purchases }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Total Amount</h6>
                <h3 class="text-success">P{{ week_purchase_amount|currency_format }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Tax Amount</h6>
                <h3 class="text-warning">P{{ week_tax_amount|currency_format }}</h3>
              </div>
            </div>
          </div>

          <!-- This Month -->
          <div class="tab-pane fade" id="month-tab-pane" role="tabpanel" aria-labelledby="month-tab" tabindex="0">
            <div class="row text-center">
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Purchase Orders</h6>
                <h3 class="text-primary">{{ month_purchases }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Total Amount</h6>
                <h3 class="text-success">P{{ month_purchase_amount|currency_format }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Tax Amount</h6>
                <h3 class="text-warning">P{{ month_tax_amount|currency_format }}</h3>
              </div>
            </div>
          </div>

          <!-- This Year -->
          <div class="tab-pane fade" id="year-tab-pane" role="tabpanel" aria-labelledby="year-tab" tabindex="0">
            <div class="row text-center">
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Purchase Orders</h6>
                <h3 class="text-primary">{{ year_purchases }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Total Amount</h6>
                <h3 class="text-success">P{{ year_purchase_amount|currency_format }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Tax Amount</h6>
                <h3 class="text-warning">P{{ year_tax_amount|currency_format }}</h3>
              </div>
            </div>
          </div>

          <!-- All Time -->
          <div class="tab-pane fade" id="all-tab-pane" role="tabpanel" aria-labelledby="all-tab" tabindex="0">
            <div class="row text-center">
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Purchase Orders</h6>
                <h3 class="text-primary">{{ total_purchases }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Total Amount</h6>
                <h3 class="text-success">P{{ total_purchase_amount|currency_format }}</h3>
              </div>
              <div class="col-md-4">
                <h6 class="text-muted mb-2">Tax Amount</h6>
                <h3 class="text-warning">P{{ total_tax_amount|currency_format }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
