{% extends 'base.html' %}
{% load currency_filters %}

{% block title %}Purchase Order Details{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Purchase Order #{{ purchase.po_number }}</h2>
    <p class="text-muted">View and manage purchase details</p>
  </div>
  <div>
    {% if purchase.received %}
      <span class="badge bg-success" style="font-size: 14px; padding: 8px 16px;">
        <i class="bi bi-check-circle"></i> Received
      </span>
    {% else %}
      <span class="badge bg-warning text-dark" style="font-size: 14px; padding: 8px 16px;">
        <i class="bi bi-clock-history"></i> Pending
      </span>
    {% endif %}
  </div>
</div>

<div class="row">
  <!-- Left Column: Purchase Details -->
  <div class="col-md-8">
    <!-- Purchase Info Card -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Purchase Information</h5>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label text-muted">PO Number</label>
            <p class="form-control-plaintext"><strong>{{ purchase.po_number }}</strong></p>
          </div>
          <div class="col-md-6">
            <label class="form-label text-muted">Date</label>
            <p class="form-control-plaintext"><strong>{{ purchase.date|date:"F d, Y" }}</strong></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Items Card -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Purchase Items</h5>
      </div>
      <div class="card-body">
        {% if purchase.items.all %}
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Product</th>
                  <th class="text-end">Quantity</th>
                  <th class="text-end">Unit Cost</th>
                  <th class="text-end">Subtotal</th>
                </tr>
              </thead>
              <tbody>
                {% for item in purchase.items.all %}
                  <tr>
                    <td>{{ item.product.name }}</td>
                    <td class="text-end">{{ item.quantity }}</td>
                    <td class="text-end">P{{ item.unit_cost|currency_format }}</td>
                    <td class="text-end"><strong>P{{ item.line_total|currency_format }}</strong></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="text-end mt-3">
            <h5>
              Total: <strong>P{{ purchase.total_amount|currency_format }}</strong>
            </h5>
          </div>
        {% else %}
          <p class="text-muted mb-0">No items added to this purchase order.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Right Column: Actions -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Actions</h5>
      </div>
      <div class="card-body d-flex flex-column gap-2">
        <!-- Mark as Received Button -->
        {% if not purchase.received %}
          <form method="post" class="w-100">
            {% csrf_token %}
            <input type="hidden" name="action" value="mark_received">
            <button type="submit" class="btn btn-success w-100">
              <i class="bi bi-check-circle"></i> Mark as Received
            </button>
          </form>
        {% else %}
          <button class="btn btn-success w-100" disabled>
            <i class="bi bi-check-all"></i> Already Received
          </button>
        {% endif %}

        <!-- Edit Button -->
        <a href="{% url 'purchases-edit' purchase.id %}" class="btn btn-info">
          <i class="bi bi-pencil"></i> Edit
        </a>

        <!-- Back Button -->
        <a href="{% url 'purchases-list' %}" class="btn btn-secondary">
          <i class="bi bi-arrow-left"></i> Back to List
        </a>

        <!-- Delete Button -->
        <a href="{% url 'purchases-delete' purchase.id %}" class="btn btn-danger">
          <i class="bi bi-trash"></i> Delete Purchase
        </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}
